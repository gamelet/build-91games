language: node_js
node_js:
  - lts/*

services:
  - docker
  
before_install:
  - git config --global core.autocrlf false && git config --global core.filemode false
  - echo -e ${REPO_ACCESS_SSHKEY} > ~/.ssh/ci
  - chmod 400 ~/.ssh/ci
  - GIT_SSH_COMMAND="ssh -i ~/.ssh/ci -o StrictHostKeyChecking=no" git clone git@bitbucket.org:goodass/gamelet.git

script:
  - cd gamelet
  - docker login --username=${ALIYUN_DOCKER_USER} --password=${ALIYUN_DOCKER_PASSWORD} registry.cn-hangzhou.aliyuncs.com
  - docker build --no-cache -t registry.cn-hangzhou.aliyuncs.com/91games/91games-server-ci -f dockers/sharp/Dockerfile .
  - docker push registry.cn-hangzhou.aliyuncs.com/91games/91games-server-ci
#  - docker build --no-cache -t registry.cn-hangzhou.aliyuncs.com/91games/91games-singleserver-ci -f dockers/single/Dockerfile .
#  - docker push registry.cn-hangzhou.aliyuncs.com/91games/91games-singleserver-ci
  - docker build --build-arg VARIANT=aotrelease --no-cache -t registry.cn-hangzhou.aliyuncs.com/91games/91games-server-aot-ci -f dockers/sharp/Dockerfile .
  - docker push registry.cn-hangzhou.aliyuncs.com/91games/91games-server-aot-ci
#  - docker build --build-arg VARIANT=aotrelease --no-cache -t registry.cn-hangzhou.aliyuncs.com/91games/91games-server-aot-ci -f dockers/sharp-ubuntu/Dockerfile .
#  - docker push registry.cn-hangzhou.aliyuncs.com/91games/91games-server-aot-ci
